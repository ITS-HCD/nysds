import { Meta, Story, Source, Canvas } from '@storybook/blocks';
import { html } from 'lit';
import * as NysFormStories from './nys-form.stories';

<Meta of={NysFormStories} title="Components/Form/Documentation" />

# Form

### Native form and Excelsior's nys-components
Excelsior form controls live inside shadow DOMs, which prevents native `<form>` elements from recognizing them. \
To solve this, Excelsior uses the **`formdata` event**. 

When a form is submitted, Excelsior automatically appends the custom component's values to the FormData object, ensuring compatibility with modern browsers.
```js
const form = document.querySelector('form');
form.addEventListener('submit', (e) => {
   e.preventDefault();
   // All form control data is available in a FormData object
   const data = new FormData(form); 
   // ...
})
```
<Canvas of={NysFormStories.nativeFormWithComponents} />


## *****------------- NYS-FORM -------------*****
### Currently on trial: it stands accused of being unnecessary. Verdict: TBD...

The **`nys-form`** component is a reusable web component for use in New York State digital products. It allows users users to enter information into a page.

An id is required.

## Wrapping with `nys-form`
To get started, wrap your desired HTML elements or NYS design system components with the `nys-form` component.
<Canvas of={NysFormStories.Form} />

## Handling `nys-submitForm` event
`nys-form` emits a custom event called `nys-submitForm`. To use this event, add an event listener on `nys-submitForm` from the `nys-form` component.

The examples below demonstrate how to handle the `nys-submitForm` event in React & Vanilla JS and process its detail.\
Then, passes the retrieved `FormData` into `useData()` function.
<Canvas of={NysFormStories.HandlingSubmission} />

### React Example
In React, you can listen to the `nys-submitForm` event by using an event handler in JSX. Here's an example:
```jsx
// ...code snippet...
useEffect(() => {
   const formElement = document.querySelector('#my-form');
   const handleFormSubmit = (e) => {
      const formData = e.detail; // Access FormData from the event detail
      useData(formData); // Process FormData with the useData() function
   };

   formElement.addEventListener('nys-submitForm', handleFormSubmit);

   return () => {
      formElement.removeEventListener('nys-submitForm', handleFormSubmit);
   };
}, []);

return (
   <nys-form id="my-form">
      <label htmlFor="fname">Enter first name: </label>
      <input id="fname" type="text" name="fname" />
      <button type="submit">Send</button>
   </nys-form>
);
```
### Vanilla JS Example
In Vanilla JavaScript, you can listen for the nys-submitForm event using addEventListener. Here's an example:
```javascript
// ...code snippet...
<nys-form id="my-form">
   <label for="fname">Enter first name: </label>
   <input id="fname" type="text" name="fname" />
   <button type="submit">Send</button>
</nys-form>

<script>
   const formElement = document.querySelector('nys-form');

   formElement.addEventListener('nys-submitForm', (e) => {
      const formData = e.detail; // Access FormData from the event detail
      useData(formData); // Process FormData with the useData() function
   });
</script>
```

### Custom Function for Handling FormData
```javascript
/**
* Example custom function to process FormData.
* Demonstrates how developers might handle the `nys-submitForm` event bubbled up from <nys-form>.
* 
* A typical example of using FormData is passing it through API to the backend.
* This example converts FormData into a key-value object for easier manipulation
* and logs the processed and raw data, and displays it in an alert.
*/
const useData = (formData: FormData) => {
   const formValues: Record<string, string> = {};
   formData.forEach((value, key) => {
      formValues[key] = value.toString();
   });

   console.log("Processed Form Values:", formValues);
   console.log("Raw FormData:", formData);
   alert(JSON.stringify(formValues, null, 2));
};
 ```

## Fieldset and Legends
You can enable `fieldset` boolean attribute and declare a legend.
The fieldset element should only be used when there are a number of related form controls that need to be grouped together. And, when the fieldset element is used, the first element inside the fieldset must be a legend.
<Canvas of={NysFormStories.Fieldset} />


## Form Property on Outer Web Components
The `form` property allows HTML elements or NYS web components (outside the form) to associate explicitly with a specific `<form>` or `<nys-form>` element by its id, regardless of the component's location on the page.

### How It Works
Use the `form` property to explicitly associate the toggle (or other components) with a specific `<form>` element or `<nys-form>` component by referencing the form's `id`.
```html
<!-- For example -->
<nys-form id="my-form">
  <nys-textinput label="Label"></nys-textinput>
  <nys-textinput label="Label"></nys-textinput>
  <nys-checkbox label="Label"></nys-checkbox>
</nys-form>
<nys-toggle form="my-form" label="Label" name="example-name"></nys-toggle>
<button form="my-form" type="submit">Submit</button>
```
<Canvas of={NysFormStories.OutsideFormElements} />

## NYS Form Components
The `<nys-form>` currently supports the following NYS components:
 - Input elements (text, email, number, password, search, tel, url)
 - TextArea
 - Select
 - Checkbox
 - Radio
<Canvas of={NysFormStories.nysComponents} />


