import { Meta, Story, Source, Canvas } from '@storybook/blocks';
import { html } from 'lit';
import * as FormStories from './form-controller.stories';

<Meta of={FormStories} title="Components/Form/Documentation" />

# Form Controls

Our form controller integrates custom form controls with native HTML form behaviors, handling association, data submission, validation, resetting, and interaction states.

Excelsior components are built using Lit.dev and utilize the **[shadow DOM](https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_shadow_DOM)**. While this approach is effective for encapsulating a component's internal structure, it prevents native `<form>` elements from recognizing form controls located inside a shadow root.
To address this, Excelsior leverages the **[formdata](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/formdata_event) event**, which is available in [all modern browsers](https://caniuse.com/mdn-api_htmlformelement_formdata_event).

<p class="pill stable">Stable</p>

<p class="pill uikit"><a href="#">Get the UI kit</a></p>

In the examples below, we demonstrate how to process the `FormData` object by listening to a native form submission event. Your form can include both standard HTML form elements and custom `nys-components`.
```js
const form = document.querySelector('form');

form.addEventListener('submit', (e) => {
   e.preventDefault();
   // Collects all form control data into a FormData object
   const data = new FormData(form); 
   // Use the FormData object as needed
   useData(formData);
});
```

```javascript
/**
* Example: custom function to process FormData.
* Though, typical usage for FormData may include passing it through API to the backend.
*/
const useData = (formData: FormData) => {
   const formValues: Record<string, string> = {};
   formData.forEach((value, key) => {
      formValues[key] = value.toString();
   });

   console.log("Processed Form Values:", formValues);
   console.log("Raw FormData:", formData);
   alert(JSON.stringify(formValues, null, 2));
};
```
<Canvas of={FormStories.nativeFormWithComponents} />

## Variants
### Required Fields
Form will handle all required attributes for you.
<Canvas of={FormStories.RequiredFields} />

### Form Property on Outer Web Components
Use the `form` property to explicitly associate components and elements with a specific `<form>` by [referencing that form's `id`](https://www.w3.org/TR/2009/WD-html5-20090212/forms.html). 
```html
<!-- For example -->
<nys-form id="my-form">
  <nys-textinput label="Label1"></nys-textinput>
  <nys-textinput label="Label2"></nys-textinput>
</nys-form>
<nys-checkbox form="my-form" label="Label3"></nys-checkbox>
<button form="my-form" type="submit">Submit</button>
```
<Canvas of={FormStories.OutsideFormElements} />

## Fieldset and Legends
The fieldset element should only be used when there are a number of related form controls that need to be grouped together. And, when the fieldset element is used, the first element inside the fieldset must be a legend.
<Canvas of={FormStories.Fieldset} />

