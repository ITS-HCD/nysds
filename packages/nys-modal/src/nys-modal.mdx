import { Meta, Story, Source, Canvas, Controls } from "@storybook/addon-docs/blocks";
import { html } from "lit";
import * as NysModalStories from "./nys-modal.stories";
import "@nysds/nys-alert";
import "@nysds/nys-icon"
import "@nysds/nys-badge"

<Meta of={NysModalStories} title="Components/Modal/Documentation" />

# Modal
<nys-alert
  type="warning"
  heading="Modal display limited in Storybook">
  YOU MUST <strong>CLOSE OUT OF THE MODAL</strong> IN ORDER TO RE-ACCESS THE SCROLLBAR 
</nys-alert>

The **`nys-modal`** component is a reusable web component that appears on top of a web page or application and requires the user to interact with it before they can return to the main content.

If an id is not passed, a unique id will be generated.

<div className="nys-grid-row nys-grid-gap-1">
  <nys-badge label="Stable" prefixIcon="code"></nys-badge>
  <nys-badge
    prefixIcon
    prefixLabel="WCAG 2.2"
    label="AA"
    intent="success"
  ></nys-badge>
  <p className="pill pill--uikit">
    <a href="https://www.figma.com/design/TODO/add/url" target="_blank">View in Figma</a>
  </p>
</div>

---

<Canvas of={NysModalStories.Basic} />

<Controls />

## Options

<nys-alert
  type="danger"
  heading="Modal display limited in Storybook">
   This modal works correctly in real applications.  
  In Storybook, it cannot cover the full screen because the parent container uses a
  <code>transform</code> style (see class <code>css-je1az9</code>), which prevents it
  from escaping the container.

  ‼️ YOU MUST <strong>CLOSE OUT OF THE MODAL</strong> IN ORDER TO RE-ACCESS THE SCROLLBAR
</nys-alert>
<br/>

### Scrolling Behavior
Avoid content-heavy modals. If content is too long, use a dedicated page or Stepper. Scrollable modals should be concise. The modal grows with content; when it exceeds the limit, only the body scrolls while header and footer stay fixed. 

**Important:** `<nys-modal>` blocks page scrolling to keep focus within the modal.

### Adding basic slots
Use the default slot to add content such as text, links, or other elements inside the modal.

**Note:** The `heading` is required for the modal title, while `subheading` is optional for extra context or instructions.
<Canvas of={NysModalStories.BasicSlot} />

### Adding action buttons
Set the modal’s visibility using the `open` property on `<nys-modal>`.
Buttons (`<nys-button>`) placed in the `actions` slot can update this property to close the modal or confirm an action.

**Note:** Make sure to add your event handler logic to set `modal.open = false` (to close) or perform any other action before closing.
<Canvas of={NysModalStories.ActionButtonSlot} />

### Mandatory Action 
A forced action modal requires users to make a choice before continuing. Set the `mandatory` prop, which turn off the dismissible button.
<Canvas of={NysModalStories.MandatoryAction} />

## Usage

### When to use this component
- Confirmations (e.g., "Are you sure you want to delete this?")
- Forms (e.g., login, signup, feedback forms)
- Alerts and notifications
- Displaying additional information without leaving the page

### When to consider something else
- Content-heavy modals should generally be avoided
- For inline status messages, use a banner or `nys-alert`
- Quick hints for form-related components (e.g. text inputs) use a tooltip or `nys-tooltip`

<div className="nys-grid-row nys-grid-gap-lg">
  <div className="nys-mobile-lg:nys-grid-col">
    <div className="usage-card usage-card--do">
      ### <nys-icon name="check_circle" color="var(--nys-color-success)" /> Do
      - Use for actions that need confirmation.
      - Keep content short and focused.
      - Use the `mandatory` prop to disable the dismiss button when the user must make a critical decision or acknowledge essential information.
    </div>
  </div>
  <div className="nys-mobile-lg:nys-grid-col">
    <div className="usage-card usage-card--dont">
      ### <nys-icon name="error" color="var(--nys-color-danger)" /> Don't
      - Don’t overload with long forms or texts.
      - Don’t show trivial info.
      - Don’t stack multiple modals.
      - Don’t force a mandatory modal unnecessarily.
    </div>
  </div>
</div>

## Accessibility

The `nys-modal` component includes the following accessibility-focused features:

- Trap focus inside the modal so keyboard users can’t tab to background content.
- Return focus to the triggering element when the modal closes.
- Support keyboard interaction — allow Esc to close the modal.
- Announce the modal to screen readers using role="dialog" or role="alertdialog" and aria-modal="true".
- Prevent background scroll so users don’t lose context.

## Slots
<table>
    <thead>
    <tr>
        <th>Slot name</th>
        <th>Description</th>
        <th>Default value</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>`actions`</td>
        <td>Place action buttons such as `nys-button` for confirm, cancel, or other choices</td>
        <td>none</td>
    </tr>
    </tbody>
</table>

## Events

The `nys-modal` component emits the following events:

1. `nys-open`: Emitted when the modal is opened.
2. `nys-close`: Emitted when the modal is closed.

**Event details** \
The `nys-open` event’s `detail` object includes:
- id (string): The id of the modal.

The `nys-close` event’s `detail` object includes:
- id (string): The id of the modal.

You can listen to these events using JavaScript:

```js
// Select the modal component
const modal = document.querySelector("nys-modal");

// Listen for the 'nys-open' event
modal.addEventListener("nys-open", (event) => {
  const { id } = event.detail;
  console.log(`Modal (${id}) is opened`);
});

// Listen for the 'nys-close' event
modal.addEventListener("nys-close", (event) => {
  const { id, reason } = event.detail;
  console.log(`Modal (${id}) is closed.`);
});
```

## Dependencies

This component automatically imports the following dependencies.

- `nys-button`
